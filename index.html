<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
    integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">


<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
    integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>


<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>Steuerrechner</title>
</head>

<script src="./calculatetax.js"></script>

<body>

    <div>

        <img src="https://sh.ch/CMS/get/file/3bc0d433-fc31-4b52-97fa-d9ba3708587e?">

        <h2>Grundstückgewinnsteuer Rechner</h2>

        <a href="https://swisstaxcalculator.estv.admin.ch/#/calculator/">Allgemeiner Steuerrechner</a>

        <br>
        <br>

        <a href="https://sh.ch/CMS/get/file/c40b0ab2-7c6d-4f44-9d09-1d95227e0588">Merkblatt zum
            Grundstückgewinnsteuer Rechner</a>
        <br>

        <a href="https://sh.ch/CMS/get/file/ca0d9d0b-64f9-45fc-9754-a186094ed97e">Berechnungstabelle</a>

        <br>
        <br>

        <form>

            <small>Bitte alle Zahlen ohne Tausender-trennzeichen eingeben</small>

            <br>
            <br>

            <div class="form-group row">
                <label for="txtverkaufspreis" class="col-sm-4 col-form-label">Verkaufspreis</label>
                <div class="input-group col-sm-4">
                    <input type="number" class="form-control" min="0" id="txtverkaufspreis" onchange="calcGSG()"
                        placeholder="" required>
                    <div class="input-group-append">
                        <span class="input-group-text">CHF</span>
                    </div>
                </div>
            </div>

            <div class="form-group row">
                <label for="txterwerbspreis" class="col-sm-4 col-form-label">Erwerbspreis + Aufwendungen</label>
                <div class="input-group col-sm-4">
                    <input type="number" min="0" class="form-control" id="txterwerbspreis" onchange="calcGSG()"
                        placeholder="" required>
                    <div class="input-group-append">
                        <span class="input-group-text">CHF</span>
                    </div>
                </div>
            </div>

            <div class="form-group row">
                <label for="txtgrundstückgewinn" class="col-sm-4 col-form-label">Grundstückgewinn</label>
                <div class="input-group col-sm-4">
                    <input type="number" class="form-control" id="txtgrundstückgewinn" placeholder="" required disabled>
                    <div class="input-group-append">
                        <span class="input-group-text">CHF</span>
                    </div>
                </div>
            </div>

            <div class="form-group row">
                <label class="col-sm-4 col-form-label">Anrechenbare Besitzdauer</label>
                <div class="input-group col-sm-2">
                    <input type="number" class="form-control" id="txtjahre" placeholder="Jahre" required>
                </div>
                <div class="input-group col-sm-2">
                    <input type="number" class="form-control" id="txtmonate" placeholder="Monate" min="0" max="11"
                        required>
                </div>
            </div>

            <div class="form-group row" id="custombutton">
                <div class="mb-2">
                    <button class="btn btn-primary text-right-custom" onclick="abschluss()">Berechnen</button>
                </div>
            </div>

        </form>

        <div class="form-group row" id="bootstrapdiv" hidden>
            <label for="txtefftax" class="col-sm-4 col-form-label">Grundstückgewinnsteuer:</label>
            <div class="input-group col-sm-4">
                <input type="text" class="form-control" id="txtefftax" placeholder="" disabled>
                <div class="input-group-append">
                    <span class="input-group-text">CHF</span>
                </div>
            </div>
        </div>

        <small>Alle Angaben ohen Gewähr</small>

    </div>

</body>

<script>

    const submit = document.querySelector("form")

    submit.addEventListener("submit", (e) => {
        e.preventDefault();
    })

    function calcGSG() {

        verkaufspreis = document.getElementById('txtverkaufspreis').value;
        erwerbspreis = document.getElementById('txterwerbspreis').value;

        if (verkaufspreis != '' && erwerbspreis != '') {
            document.getElementById('txtgrundstückgewinn').value = (verkaufspreis - erwerbspreis);
        }

    }

    async function abschluss() {

        let taxableamount = document.getElementById('txtgrundstückgewinn').value; // define the taxable amount
        let jahre = Number(document.getElementById('txtjahre').value); // define number of years
        let monate = Number(document.getElementById('txtmonate').value);// define number of months

        let totalmonths = (jahre * 12) + monate;

        let efftax = 0; // reset tax value

        if (taxableamount != '' && (jahre != undefined) && (monate != undefined) && monate <= 11) {
            if (taxableamount >= 5000 && taxableamount <= 100000) {

                console.log("weniger als 100k, mehr als 5k, " + totalmonths + " monate")
                efftax = await calculatetax(taxableamount, totalmonths); // Await the result of calculatetax

            } else if (taxableamount > 100000) {
                taxableamount = taxableamount * 0.15; // If over 100,000 -> 15% tax
                console.log("mehr als 100k, " + totalmonths + " monate")
                efftax = calculateAddTax(taxableamount, totalmonths)
            } else {
                efftax = 0; // If less than 5000 -> 0
            }

            document.getElementById('txtefftax').value = efftax;
            document.getElementById('bootstrapdiv').hidden = false;
        }
    }

</script>

</html>